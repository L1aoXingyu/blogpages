---
title: CodeLLM Training Recipe
pubDatetime: 2023-07-26
description: 一个偏综述的文章，总结 codeLLM 相关 paper 从 data collection 到 training 中间的一些细节
tags:
  - LLM
  - codeLLM
  - pre-train
  - data clean
  - survey
  - training recipe
draft: false
---

> codeLLM 算是 LLM 中最大的一个垂类应用，最近也有一些工作 focus 在 codeLLM 上，比如 StarCoder[^1] 等，从数据的收集到训练都有涉及。
>
> 和通常的 LLM training 相比，codeLLM 存在较多细节上的不同，这里按发表的时间，选择了 CodeParrot[^2], InCoder[^3], Santacoder[^4], StarCoder[^1] 和 CodeGen2[^5] 这几个模型，总结这些细节，方便以后查阅。

## Table of contents

## Data Collection

数据是 LLM 训练的基石，从数据的采集到清洗都非常重要，下面先从数据的收集开始总结不同模型的区别。

### CodeParrot

CodeParrot 使用的数据通过 Google 的 [BigQuery](https://cloud.google.com/blog/topics/public-datasets/github-on-bigquery-analyze-all-the-open-source-code) 来获取 GitHub dump，只从数据库中检索了所有小于 1MB 的 Python 文件，最终收集的数据集有 180GB，包含 20M 个文件。

### InCoder

InCoder 收集的数据主要包含两个数据来源：GitHub(GitLab) 和 StackOverflow。

#### GitHub(GitLab)

在 GitHub(GitLab) 中，一共收集了 28 种编程语言[^6]，所有收集的代码文件都遵循 permissive license，下面是不同编程语言的整体分布。

<div align=center>
<img src="/assets/codeLLM/incoder-pl.png" width=500>
</div>

代码文件和仓库的 **metadata**[^7] 通过 GitHub API 获取，截止于 2021-12-9。
收集 primary language 是 Python，JavaScript 和 Jupyter Notebook 的仓库，同时遵守 permissive license。

对于 repo 中的 code file，通过 extension，按照之前约定的 28 种编程语言进行选择。
另外也存在 primary language 不是 Python 的仓库，但是里面包含 Python 的代码文件，对于这种情况，通过 BigQuery 进行检索，收集所有 Python 和 Jupyter 代码文件。
经过后续处理之后，一共有 159GB 的代码文件，其中 Python 占 52GB。

#### StackOverflow

在 StackOverflow 上，收集 **Question, Answers and Comments**。
对于 StackOverflow 的数据，其 **metadata** 是 question tags(e.g., python, django), 和每个 question 和 answer 的点赞数。

对于所有的 question 来说，只收集至少有一个 answer 的问题，每个问题的 answer 按照分数排序，最多选 10 个，每个 question/answer 最多选 5 个 comments。
经过后续处理之后，一共有 57GB 的内容。

### SantaCoder

SantaCoder 使用的训练数据主要从 The Stack v1.1[^8] 中选择的 Python, Java 和 JavaScript 这三种编程语言，大小是 268GB。

### StarCoder

代码数据来自于 The Stack v1.2[^8]，一共包含 358 种编程语言，最终只选择了 86 种。

GitHub Issues 包含对话和对应的 action event(e.g., opening the issue, creating a comment)。每个 event 包含着作者的 username, message, action 和 creation date。

Git Commits 通过 BigQuery 来获取，对于 repositories 来说，包含里面单个代码文件的 commit 信息。

### CodeGen2

CodeGen2 使用的数据和 StarCoder 一模一样。

## Data Curation and Cleaning

## Data Formatting

## Training Details

## Reference

[^1]: https://arxiv.org/abs/2106.06106
[^2]: https://github.com/huggingface/transformers/tree/main/examples/research_projects/codeparrot
[^3]: https://arxiv.org/pdf/2204.05999.pdf
[^4]: https://arxiv.org/pdf/2301.03988.pdf
[^5]: https://arxiv.org/pdf/2305.02309.pdf
[^6]: We include source files from C, C++, CSS, C#, Common Lisp, Dart, Forth, Go, HTML, Haskell, Java, JavaScript, Julia, Jupyter, Kotlin, Lua, Matlab, PHP, Perl, Python, R, Ruby, Rust, SQL, Scala, Shell, Swift, and TypeScript, although the great majority of files are Python and JavaScript.
[^7]: For code file, filename, file extension, file source (GitHub or GitLab). For repositories, the number of stars.
[^8]: https://huggingface.co/datasets/bigcode/the-stack#changelog
